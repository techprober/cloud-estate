---
# --- STAGE 1: Bootstrap cloudimg ---
- name: "Bootstrap cloudimg"
  hosts: proxmox_servers
  become: yes

  # vars_files:
  #   - ./group_vars/all.yml

  roles:
    - role: "remote.cloudimg/"

# --- STAGE 2: Build VM template ---
- name: "Build VM template"
  hosts: localhost
  connection: local

  # vars_files:
  #   - ./group_vars/all.yml

  roles:
    - role: "local.packer-build/"

# --- STAGE 3: Run post-install tasks ---
- name: "Run post-install tasks"
  hosts: proxmox_servers
  become: yes

  # vars_files:
  #   - ./group_vars/all.yml

  roles:
    - role: "remote.post-install.cloudinit/"
